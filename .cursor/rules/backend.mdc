# Backend Rules

Обязательные правила серверной части:

- Все функции и классы документировать (docstrings).
- Все ошибки логировать структурированно, без утечек секретов.
- Валидация входных данных для вебхука и любого user input.
- Webhook защищать секретным токеном.
- Все секреты только в env, никаких ключей в коде.
- Таймзона пользователя хранится в БД; по умолчанию Europe/Moscow.
- Оптимизация: лимит контекста, лимит истории, кэш там где нужно.

AI слой:
- OpenRouter как основной провайдер.
- Модель по умолчанию: deepseek/deepseek-chat-v3-0324.
- При ответах с фактами — обязательный граундинг (web search).
- Tool calling использовать для поиска, памяти, задач, напоминаний.

Хранение:
- Supabase Postgres + pgvector.
- Все записи пользователя маркировать user_id.
- Обязательно RLS policies (планировать).
